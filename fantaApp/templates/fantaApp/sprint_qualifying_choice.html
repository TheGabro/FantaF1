{% extends 'fantaApp/base.html' %} {% load dict_extras %} {% block content %}
<h2>{{ weekend.event_name }} – Sprint Qualifying</h2>

{% if messages %} {% for message in messages %}
<p style="color:{% if message.tags == 'error' %}red{% else %}green{% endif %};">
  {{ message }}
</p>
{% endfor %} {% endif %} {% if event_started %}
<p><strong>Le scelte per questa Sprint-Qualifying sono chiuse.</strong></p>
{% else %}
<form method="post">
  {% csrf_token %}
  <table>
    <thead>
      <tr>
        <th>Slot</th>
        <th>Pilota selezionato / Disponibile</th>
      </tr>
    </thead>
    <tbody>
      {% for code, label in slots %}
      <tr>
        <td>{{ label }}</td>
        <td>
          {% if code in existing %} {% with choice=existing|get_item:code %} ✔
          {{ choice.driver.short_name }} {% endwith %} {% else %}
          <select name="driver_{{ code }}" id="driver_{{ code }}" required>
            <option value="" disabled selected>-- scegli pilota --</option>
            {% for d in drivers %}
            <option value="{{ d.id }}">
              {{ d.team.short_name }} - {{ d.first_name }} {{d.last_name}}
            </option>
            {% endfor %}
          </select>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <button type="submit">Salva tutte le scelte</button>
</form>
{% endif %} {% endblock %}
